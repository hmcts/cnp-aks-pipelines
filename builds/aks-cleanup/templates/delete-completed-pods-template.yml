---
parameters:
  - name: serviceConnection
    type: object
    default:
      - name: DCD-CFTAPPS-DEV
        clusters:
          - name: preview-00-aks
            rg: preview-00-rg
          - name: preview-01-aks
            rg: preview-01-rg
        namespaces:
          - rpe

steps:
  - ${{ each sc in parameters.serviceConnection }}:
    - ${{ each c in sc.clusters }}:
      - task: AzureCLI@1
        displayName: 'Delete Completed pods in $(c.name) [$(sc.name)]'
        inputs:
          azureSubscription: $(sc.name)
          scriptLocation: scriptPath
          scriptPath: scripts/delete-completed-pods.sh
          arguments: $(c.rg) $(c.name) ${{ join(';', sc.namespaces) }}