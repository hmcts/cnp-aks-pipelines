parameters:
  serviceConnection: ''
  acrName: ''
  acrResourceGroup: ''

steps:
- task: AzureCLI@1
  displayName: 'Delete dangling image layers'
  inputs:
    azureSubscription:  ${{ parameters.serviceConnection }}
    scriptLocation: 'inlineScript'
    inlineScript: |
      REPOSITORIES=$(az acr repository list --name ${{ parameters.acrName }} --resource-group ${{ parameters.acrResourceGroup }} -o tsv)
      for repo in $REPOSITORIES
      do
        printf $repo
      done