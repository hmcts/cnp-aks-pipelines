  parameters:
    serviceConnection: ''
    keyvaultName: ''

  steps:
  - task: AzureKeyVault@1
    displayName: 'Get secrets from Keyvault'
    inputs:
      azureSubscription: ${{ parameters.serviceConnection }}
      keyVaultName: ${{ parameters.keyvaultName }}
      secretsFilter: 'aks-sp-id,aks-sp-secret,jenkins-sp-subscription-id,jenkins-sp-tenant-id,jenkins-sp-id,jenkins-sp-secret,pact-db-user,pact-db-password'      

  - script: |
      echo "##vso[task.setvariable variable=aksServicePrincipalId;isOutput=true]$(aks-sp-id)"
      echo "##vso[task.setvariable variable=aksServicePrincipalSecret;isOutput=true]$(aks-sp-secret)"
      echo "##vso[task.setvariable variable=svcatServicePrincipalSubscriptionId;isOutput=true]$(jenkins-sp-subscription-id)"
      echo "##vso[task.setvariable variable=svcatServicePrincipalId;isOutput=true]$(jenkins-sp-id)"
      echo "##vso[task.setvariable variable=svcatServicePrincipalSecret;isOutput=true]$(jenkins-sp-secret)"
      echo "##vso[task.setvariable variable=svcatServicePrincipalTenantId;isOutput=true]$(jenkins-sp-tenant-id)"
      echo "##vso[task.setvariable variable=pactDbUser;isOutput=true]$(pact-db-user)"
      echo "##vso[task.setvariable variable=spactDbPassword;isOutput=true]$(pact-db-password)"
    displayName: 'Export Keyvault Variables'
    name: exportKeyvault